# 

**Gist ID:** 05e45219b92935ba4695
**Created:** 2015-12-30T11:11:11Z
**Last updated:** 2015-12-30T11:11:11Z

## File: `camera.reds`

```Red
Red/System [
Title:		"OpenCV Camera Test"
Author:		"Fran?ois Jouen"
Rights:		"Copyright (c) 2012-2013 Fran?ois Jouen. All rights reserved."
License:     "BSD-3 - https://github.com/dockimbel/Red/blob/master/BSD-3-License.txt"
]

#include %../../libs/red/types_r.reds           ; some specific structures for Red/S
#include %../../libs/core/types_c.reds          ; basic OpenCV types and structures
#include %../../libs/core/core.reds             ; OpenCV core functions
#include %../../libs/imgproc/types_c.reds       ; image processing types 	and structures
#include %../../libs/imgproc/imgproc.reds       ; OpenCV image  processing
#include %../../libs/highgui/highgui.reds       ; highgui functions
#include %../../libs/imgcodecs/imgcodecs.reds   ; basic image functions
#include %../../libs/videoio/videoio.reds       ; to play with camera
;#include %../opencv.reds
; use  default camera
cvStartWindowThread ; separate window thread
;capture: cvCreateFileCapture "http://210.243.41.156/axis-cgi/mjpg/video.cgi?camera=4"
;capture: cvCreateFileCapture "http://cam.luzern.org/axis-cgi/mjpg/video.cgi?action=stream.mjpeg"
capture: cvCaptureFromCAM 0 ; create a cature using default webcam (iSight) ; change to n for other cam
print [capture lf]
if capture = null [print "error!" lf]

width:  cvGetCaptureProperty capture CV_CAP_PROP_FRAME_WIDTH
height: cvGetCaptureProperty capture CV_CAP_PROP_FRAME_HEIGHT
fourcc: cvGetCaptureProperty capture CV_CAP_PROP_FOURCC
?? fourcc
?? width
?? height

cvNamedWindow "Webcam" CV_WINDOW_AUTOSIZE ; create window to show movie

probe cvGrabFrame capture
image: cvRetrieveFrame capture ; get the first image
&image: as byte-ptr! image ; pointer address
&&image: declare double-byte-ptr!
&&image/ptr: &image; double pointeur

assert &image <> null ; test image status

key:  27
foo: 0

; repeat until q keypress
while [foo <> key] [
    if zero? cvGrabFrame capture [
        probe "error"
        break
    ]
    image: cvRetrieveFrame capture      ; get the frame
    cvShowImage "Webcam" &image    ; show frame
    ;if rec [cvWriteFrame writer image]  ; write frame on disk if we want to record movie (set rec to true for testing)
    foo: cvWaitKey 1
]

print ["Done. Any key to quit" lf]
cvWaitKey 0
; releases structures and windows
cvDestroyAllWindows
cvReleaseImage &&image
caphandle: as-integer capture
cvReleaseCapture as double-byte-ptr! :caphandle

```

## Comments

No comments.
