
#5394: Redbin crashes instead of doing some error checking
================================================================================
Issue is open, was reported by hiiamboris and has 6 comment(s).
[status.waiting] [status.built] [type.bug]
<https://github.com/red/red/issues/5394>

**Describe the bug**
```
>> load/as #{52454442494E1111111111111111111111} 'redbin

*** Runtime Error 1: access violation
*** in file: /d/devel/red/red-src/master/runtime/redbin.reds
*** at line: 1668
***
***   stack: red/redbin/decode-word* 0586A208h 00000000h 04B31FFCh false
***   stack: red/redbin/decode-value 0586A208h 00000000h 04B31FFCh
***   stack: red/redbin/decode 0586A1F8h 04B31FFCh true
***   stack: ctx||323~decode 04B31FECh
***   stack: red/interpreter/exec-routine 04B31FDCh
***   stack: red/interpreter/eval-code 05588548h 05798878h 05798878h 04B31FCCh false 05798858h 057988A0h 04B31F1Ch 0 false
***   stack: red/interpreter/eval-path 057988A0h 05798868h 05798878h 04B31FCCh false false false false
***   stack: red/interpreter/eval-expression 05798868h 05798878h 04B31FCCh false false false
***   stack: red/interpreter/eval 04B31FCCh true
***   stack: red/natives/do* true -1 -1 -1 -1
***   stack: load
***   stack: red/interpreter/call 04B31E3Ch 03263884h 0586A230h 0
***   stack: red/interpreter/eval-code 054A0428h 0586A260h 0586A260h 04B31E1Ch true 0586A230h 0586A1C0h 054A0428h 0 false
***   stack: red/interpreter/eval-path 0586A230h 0586A240h 0586A260h 04B31E1Ch false false false false
***   stack: red/interpreter/eval-expression 0586A240h 0586A260h 04B31E1Ch false false false
***   stack: red/interpreter/eval 04B31E1Ch true
***   stack: red/natives/catch* true 1
***   stack: ctx||626~try-do 0327F7C8h
***   stack: ctx||626~do-command 0327F7C8h
***   stack: ctx||626~eval-command 0327F7C8h
***   stack: ctx||626~run 0327F7C8h
***   stack: ctx||626~launch 0327F7C8h
***   stack: ctx||645~launch 0327F1B4h
```


**Expected behavior**

Invalid data error or smth.

**Platform version**
```
-----------RED & PLATFORM VERSION----------- 
RED: [ branch: "master" tag: #v0.6.4 ahead: 5003 date: 2-Oct-2023/2:42:29 commit: #ffd15f809fc999654bb73ccc2ea18d47619ecaec ]
PLATFORM: [ name: "Windows 10" OS: 'Windows arch: 'x86-64 version: 10.0.0 build: 19044 ]
--------------------------------------------
```


Comments:
--------------------------------------------------------------------------------

On 2023-10-02T20:07:58Z, dockimbel, commented:
<https://github.com/red/red/issues/5394#issuecomment-1743682657>

    The Redbin decoding functions are all wrongly assuming that the full record is available, input end checking is done only in-between records. So all decoding functions need to be upgraded for better robustness. Vladimir, who designed that, just copied the existing decoding functions interface (1.1 version), but that version is only for decoding the trusted payload generated by the Red compiler. I missed it too when reviewing his code.

--------------------------------------------------------------------------------

On 2023-10-04T16:58:55Z, dockimbel, commented:
<https://github.com/red/red/issues/5394#issuecomment-1747298963>

    This fix checks for static size expectations for each type of Redbin record, but not for dynamic buffers nor cross-dependent records (like dependency on contexts). Covering all the possible holes would require a significant time analyzing all possible ways to break the decoder with invalid or malign input data. I am not willing to invest such time for now, so I will leave this ticket in "waiting" state, until someone finds time to do a thorough analysis.

--------------------------------------------------------------------------------

On 2024-03-29T17:29:38Z, 9214, commented:
<https://github.com/red/red/issues/5394#issuecomment-2027525432>

    > The Redbin decoding functions are all wrongly assuming that the full record is available, input end checking is done only in-between records.
    
    Yes. I explicitly stated that as an open design question in the original PR https://github.com/red/red/pull/4586:
    
    > Sandboxing and Secure dialect: right now feeding decoder with malformed payload will likely lead to a [big bada boom](https://www.youtube.com/watch?v=j8WLYzA0lCs), since it implements only naive poka-yoke checks of the input; graceful handling of incorrect encoding • will degrade performance on runtime booting • is infeasible in the general case.
    
    And even put a warning in the [spec](https://github.com/red/docs/blob/master/en/redbin.adoc):
    
    > Attempt to load Redbin data with malformed payload will likely lead to unexpected results or a runtime crash.
    
    The reason I left it that way was lack of time and resources, which, as @dockimbel said above, are required for a thorough analysis of all the required checks and their trade-offs — which, my gut tells me, are a hard thing to pull off simple and effectively with the current single-pass codec architecture.

