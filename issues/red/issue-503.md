
#503: float! aligns to 4 bytes instead of 8
================================================================================
Issue is closed, was reported by Kaj-de-Vos and has 16 comment(s).
[Red/System] [test.written] [status.wontfix]
<https://github.com/red/red/issues/503>

```
Red/System []

s!: alias struct! [
    i   [integer!]
    f   [float!]
]
print-line size? s!
```

12

In an MS C compiler for Windows, I get a struct of 16 bytes. Are there any systems that pack them tighter but unaligned?



Comments:
--------------------------------------------------------------------------------

On 2013-08-03T14:33:56Z, dockimbel, commented:
<https://github.com/red/red/issues/503#issuecomment-22055772>

    I'm not sure to understand what the issue is? Does that generate runtime errors? Is it a speed optimization wish?

--------------------------------------------------------------------------------

On 2013-08-03T14:39:19Z, Kaj-de-Vos, commented:
<https://github.com/red/red/issues/503#issuecomment-22055855>

    Structs generated by Red/System are incompatible with structs from other compilers, so yes, runtime errors.
    
    I guess splitting float values over possibly two hardware accesses also hurts performance.

--------------------------------------------------------------------------------

On 2013-08-03T17:32:11Z, dockimbel, commented:
<https://github.com/red/red/issues/503#issuecomment-22058317>

    There's two different points there:
    1. Aligning 64-bit values on 64-bit boundaries is certainly desirable wrt hardware requirements.
    2. Struct alignments are project-specific, not compiler-specific. You can change them usually with a compiler option. In Red/System, we have an entry under "Possible Evolutions" section in the spec for supporting such non-default members alignment. It is not possible to implement it currently due to the amount of internal changes it would require, so it's a 2.0 feature.

--------------------------------------------------------------------------------

On 2013-08-03T17:42:55Z, dockimbel, commented:
<https://github.com/red/red/issues/503#issuecomment-22058482>

    Actually, the 64-bit alignment is honored, it seems to be a `size?` bug.

--------------------------------------------------------------------------------

On 2013-08-04T13:26:32Z, Kaj-de-Vos, commented:
<https://github.com/red/red/issues/503#issuecomment-22071672>

    That would surprise me, because the code is incompatible. I need to add padding manually.

--------------------------------------------------------------------------------

On 2013-08-04T19:54:01Z, dockimbel, commented:
<https://github.com/red/red/issues/503#issuecomment-22077663>

    Right, it seems more complex than that, I am working on it, as I found other struct alignment issues.

--------------------------------------------------------------------------------

On 2013-08-05T12:38:50Z, dockimbel, commented:
<https://github.com/red/red/issues/503#issuecomment-22103338>

    I have spent 1.5 day on this and my conclusion is that we won't change anything until Red/System 2.0.
    
    For dealing with external interfacing or speed optimizations, some additional properties are planned (as mentioned above) but won't be implemented until 2.0. Also, we want to support more features in structs in 2.0 like bitsets and unions, so a full re-implementation will be required. Trying to add C-like alignments right now is breaking too many things in the Red and Red/System runtimes.
    
    This ticket should be converted to a struct-related task entry in 2.0 todo-list.

--------------------------------------------------------------------------------

On 2013-08-05T13:24:52Z, PeterWAWood, commented:
<https://github.com/red/red/issues/503#issuecomment-22105600>

    I've added this as request 37 on the Red/System V2 wish list.

