
#3797: [Compiler] `self` isn't recognized by `react`
================================================================================
Issue is closed, was reported by hiiamboris and has 12 comment(s).
[status.resolved] [type.review]
<https://github.com/red/red/issues/3797>

**Describe the bug**

%1.red:
```
Red []
r: make reactor! [a: 1 react [self/a print 123]]
```
Compiled (-c/-r doesn't matter)
```
> red -c 1.red & 1.exe
*** Script Error: self has no value
*** Where: get
*** Stack: react
```

**Expected behavior**

Works when interpreted, should also work compiled.

**Platform version (please complete the following information)**
```
Red 0.6.4 for Windows built 30-Jan-2019/9:03:13+03:00 commit #25ef631
```



Comments:
--------------------------------------------------------------------------------

On 2020-06-16T19:11:44Z, hiiamboris, commented:
<https://github.com/red/red/issues/3797#issuecomment-644959932>

    No error report anymore now. But the reaction is not being registered when compiled.

--------------------------------------------------------------------------------

On 2022-08-30T13:39:30Z, dockimbel, commented:
<https://github.com/red/red/issues/3797#issuecomment-1231684638>

    This behavior is by design. `self` is a keyword and not a slot in the object's context (see [explanation](https://github.com/red/red/issues/4501#issuecomment-1231656729)).
    
    So, in order to accomplish what you want, you need to explicitly assign a slot in the object to such self-reference. The following example works as you expected when compiled:
    ```
    Red []
    r: make reactor! [a: 1 parent: self react [parent/a print 123]]
    ```

--------------------------------------------------------------------------------

On 2022-08-30T19:51:13Z, greggirwin, commented:
<https://github.com/red/red/issues/3797#issuecomment-1232097745>

    `Self` will be an important thing to spec and doc, because it's special and cases like this are likely to come up a lot.

--------------------------------------------------------------------------------

On 2022-08-30T20:28:28Z, dockimbel, commented:
<https://github.com/red/red/issues/3797#issuecomment-1232133225>

    The issue is that the reaction is evaluated later, outside of the object, so `self` is "out of context". Setting a reaction on a reactor! object from within is not the "normal" way to do it. Here is the usual way:
    ```
    r: make reactor! [a: 1]
    react [r/a print 123]
    
    >> r/a: 2
    123
    == 2
    ```

--------------------------------------------------------------------------------

On 2022-08-30T20:33:21Z, hiiamboris, commented:
<https://github.com/red/red/issues/3797#issuecomment-1232137862>

    > The issue is that the reaction is evaluated later, outside of the object, so `self` is "out of context".
    
    You must be confusing something. It works in interpreter. During `react` evaluation, `self` has value and `react` gets an object value out of it, listing it in the sources.
    
    
    

--------------------------------------------------------------------------------

On 2022-08-31T14:49:10Z, dockimbel, commented:
<https://github.com/red/red/issues/3797#issuecomment-1233040067>

    You're right, the `react`'s block argument is not compiled, but processed at run-time by the interpreter. The issue happens during `react`'s processing of the block argument, `self` has no context, so generate and error.
    
    That said, `self` has a "special" context resolution, but the extra info needed for that seems to not have been generated by the compiler for the interpreter to process it... It seems those extra info linking `self` to the object are lost during Redbin encoding stage for that argument block. Given that the compiler will be deprecated soon, I won't do any patching for that.

